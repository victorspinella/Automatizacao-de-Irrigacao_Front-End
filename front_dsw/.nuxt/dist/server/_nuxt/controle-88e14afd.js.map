{"version":3,"file":"controle-88e14afd.js","sources":["../../../../pages/controle.vue"],"sourcesContent":["<template>\r\n  <Header />\r\n  <div class=\"page-container\">\r\n    <div>\r\n      <button class=\"button\" @click=\"listarControles\">Listar Controles</button>\r\n      <button style=\"width: 125px;\" :style=\"{ backgroundColor: attAuto ? 'Green' : 'Red' }\" class=\"button\"\r\n        @click=\"ligaDesligaAuto\">Tempo Real</button>\r\n    </div>\r\n    <br>\r\n    <div>{{ mensagemPadrao }}</div>\r\n    <div v-if=\"listaControles.length !== 0\" class=\"table-container\">\r\n      <table class=\"custom-table\">\r\n        <thead>\r\n          <tr>\r\n            <th>Estufa</th>\r\n            <th>Bomba</th>\r\n            <th>Válvula</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr v-for=\"controle in listaControles\" :key=\"controle.id\">\r\n            <td>{{ controle.estufa_id }}</td>\r\n            <td :class=\"{ 'ativo': controle.comando_bomba, 'inativo': !controle.comando_bomba }\">{{ controle.comando_bomba\r\n              ? \"Ativa\" : \"Inativa\" }}</td>\r\n            <td :class=\"{ 'ativo': controle.comando_valvula, 'inativo': !controle.comando_valvula }\">{{\r\n              controle.comando_valvula ? \"Ativa\" : \"Inativa\" }}</td>\r\n            <td><button class=\"button\" @click=ligaDesliga(controle.id)\r\n                :style=\"{ backgroundColor: controle.comando_bomba && controle.comando_valvula ? 'Green' : 'Red' }\">{{ controle.comando_bomba\r\n                  && controle.comando_valvula ? \"Ativo\" : \"Inativo\" }}</button></td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  </div>\r\n</template>\r\n    \r\n<script setup>\r\nimport { ref } from 'vue';\r\nimport { api } from '../infra/axios-config'\r\n\r\n\r\nconst apiUrlControles = `http://localhost:4000`;\r\nconst mensagemPadrao = \"\"\r\n\r\nconst ligaDesliga = (id) => {\r\n  const controleEncontrado = listaControles.value.find(item => item.id === id);\r\n  const bomba = controleEncontrado.comando_bomba;\r\n  const valvula = controleEncontrado.comando_valvula;\r\n  if (bomba && valvula) {\r\n    desligar(id)\r\n  } else {\r\n    ligar(id)\r\n  }\r\n  listarControles();\r\n}\r\n\r\nconst ligar = async (id) => {\r\n  try {\r\n    const response = await api.put(`${apiUrlControles}/ligar/controles/${id}`);\r\n  } catch (error) {\r\n    console.error('Erro ao ligar:', error);\r\n    if(error.response.status === 401){\r\n      window.alert('Usuário não autenticado')\r\n    }\r\n  }\r\n  listarControles();\r\n};\r\n\r\nconst desligar = async (id) => {\r\n  try {\r\n    const response = await api.put(`${apiUrlControles}/desligar/controles/${id}`);\r\n  } catch (error) {\r\n    console.error('Erro ao desligar:', error);\r\n    if(error.response.status === 401){\r\n      window.alert('Usuário não autenticado')\r\n    }\r\n  }\r\n  listarControles();\r\n};\r\n\r\nconst listaControles = ref([]);\r\n\r\nconst listarControles = async () => {\r\n\r\n  try {\r\n\r\n    const response = await api.get(`${apiUrlControles}/controlesIrrigacao`);\r\n\r\n\r\n    listaControles.value = response.data;\r\n  } catch (error) {\r\n    console.error('Erro ao buscar dados:', error);\r\n    if(error.response.status === 401){\r\n      window.alert('Usuário não autenticado')\r\n    }\r\n  }\r\n};\r\n\r\n\r\nlet attAuto = ref()\r\nattAuto.value = false\r\nlet myInterval\r\n\r\nconst ligaDesligaAuto = () => {\r\n  if(!localStorage.getItem('token')){\r\n    window.alert('Usuário não autenticado')\r\n    return\r\n  }\r\n  attAuto.value = !attAuto.value\r\n  if (attAuto.value == true) {\r\n    atualizarAuto()\r\n    myInterval = setInterval(atualizarAuto, 10000);\r\n  } else {\r\n    clearInterval(myInterval)\r\n    console.log('Att Auto Desligada')\r\n  }\r\n\r\n}\r\n\r\nconst atualizarAuto = () => {\r\n  if (attAuto.value == true) {\r\n    listarControles()\r\n    console.log(\"Atualizado\")\r\n  } else {\r\n    console.log(attAuto.value + ' - ELSE')\r\n  }\r\n}\r\n\r\n\r\n</script>\r\n    \r\n<style lang=\"scss\" scoped>\r\n.page-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 100vh;\r\n  flex-direction: column;\r\n}\r\n\r\n.button-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n\r\n.button {\r\n  margin: 10px;\r\n  padding: 10px 20px;\r\n  background-color: #007BFF;\r\n  color: #fff;\r\n  border: none;\r\n  border-radius: 5px;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s ease;\r\n  width: 150px;\r\n}\r\n\r\n.button:hover {\r\n  background-color: #75aae2;\r\n}\r\n\r\n.manual-buttons {\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.manual-buttons button {\r\n  margin: 5px;\r\n  padding: 10px 20px;\r\n  background-color: #007BFF;\r\n  color: #fff;\r\n  border: none;\r\n  border-radius: 5px;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s ease;\r\n  width: 100px;\r\n}\r\n\r\n.manual-buttons button:hover {\r\n  background-color: #75aae2;\r\n}\r\n\r\n.table-container {\r\n  width: 80%;\r\n  margin-top: 20px;\r\n  overflow-y: auto;\r\n  /* Adiciona a barra de rolagem vertical */\r\n}\r\n\r\n.custom-table {\r\n  width: 100%;\r\n  /* Ajustado para 100% para preencher o contêiner */\r\n  border-collapse: collapse;\r\n}\r\n\r\n.custom-table th,\r\n.custom-table td {\r\n  border: 1px solid #ddd;\r\n  padding: 8px;\r\n  text-align: center;\r\n}\r\n\r\n.custom-table th {\r\n  background-color: #f2f2f2;\r\n  font-weight: bold;\r\n}\r\n\r\n.ativo {\r\n  background-color: green;\r\n  color: white;\r\n}\r\n\r\n.inativo {\r\n  background-color: red;\r\n  color: white;\r\n}</style>\r\n    "],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AA0CA,MAAM,iBAAiB;;;;;AAsCvB,UAAM,iBAAiB,IAAI,CAAA,CAAE;AAmB7B,QAAI,UAAU,IAAK;AACnB,YAAQ,QAAQ;;;;;;;;;;;;;;;;;;;;;;;;;;"}